var View=function(e){var t=3e3,n=document.getElementById("online_number"),s=document.getElementsByClassName("ws-flag"),r=document.getElementById("ceillist"),i=document.getElementById("login"),a=document.getElementById("loginBtn"),d=document.getElementById("nickname"),l=document.getElementById("addCeil"),c=document.getElementById("addCeilBtn"),o=document.getElementById("ceilname"),u=document.getElementById("addCeilSureBtn"),m=document.getElementById("stand"),g=document.getElementById("hit"),f=document.getElementById("begin"),E=document.getElementById("exit"),h=document.getElementById("up-cards"),C=document.getElementById("down-cards"),A=document.getElementById("index"),p=document.getElementById("ceil"),v=document.getElementById("message"),b={addHandler:function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},removeHandler:function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null}},w=function(){b.addHandler(a,"click",function(e){G(e)}),b.addHandler(c,"click",I),b.addHandler(u,"click",function(e){_(e)}),b.addHandler(r,"click",function(e){P(e)})},y=function(){myCards.setNull(),opCards.setNull(),Cards.getNewCards(),F(),R(),b.addHandler(E,"click",e.exitRequest),b.addHandler(f,"click",W),"blanker"===User.getUserType()&&N()},B=function(){i.setAttribute("class","ws-hide")},I=function(){l.setAttribute("class","ws-login")},S=function(){l.setAttribute("class","ws-hide")},k=function(){A.setAttribute("class","ws-hide"),S(),p.setAttribute("class","ws-ceil"),y()},U=function(){p.setAttribute("class","ws-hide"),A.removeAttribute("class")},N=function(){f.setAttribute("class","ws-hide"),b.removeHandler(f,"click",W)},x=function(){f.setAttribute("class","ws-hide"),E.setAttribute("class","ws-hide")},T=function(){E.setAttribute("class","ws-hide")},R=function(){f.setAttribute("class","ws-option ws-begin"),E.setAttribute("class","ws-option ws-exit")},H=function(){b.addHandler(m,"click",D),b.addHandler(g,"click",j),m.setAttribute("class","ws-action ws-stand"),g.setAttribute("class","ws-action ws-hit")},L=function(){b.removeHandler(m,"click",D),b.removeHandler(g,"click",j),m.setAttribute("class","ws-action ws-stand ws-locked"),g.setAttribute("class","ws-action ws-hit ws-locked")},M=function(e,n){v.innerText=e,v.setAttribute("class","ws-message"),setTimeout(function(){q(n)},t)},q=function(){v.setAttribute("class","ws-hide"),next?U():y()},G=function(t){t.preventDefault();var n=d.value;""==n?alert("昵称不能为空"):e.loginRequest(n)},_=function(t){t.preventDefault();var n=o.value;""==n?alert("房间昵称不能为空"):e.addCeilRequest(n)},P=function(t){t.preventDefault();var n=t.target||t.srcElement,s=n.parentNode.parentNode.parentNode,r=s.getAttribute("href"),i=s.getAttribute("title");e.enterRequest(r,i)},W=function(){"player"===User.getUserType()?(x(),H()):T(),myCards.addCard(Cards.getNewCard());var t=Cards.getNewCard();myCards.addCard(t);var n=myCards.getAllCards();n.map(function(e){O(e)}),e.beginRequest(t),Q(n)&&(e.bustRequest(),"player"===User.getUserType()?M(Const.MESSAGE.PLAYER_BUST):"blanker"===User.getUserType()&&M(Const.MESSAGE.BLANKER_BUST))},j=function(){var t=Cards.getNewCard();myCards.addCard(t),O(t),e.hitRequest(t),Q(cards)&&(e.bustRequest(),"player"===User.getUserType()?M(Const.MESSAGE.PLAYER_BUST):"blanker"===User.getUserType()&&M(Const.MESSAGE.BLANKER_BUST))},D=function(){L(),e.standRequest(myCards.getAllCards()[0]),"blanker"===User.getUserType()&&J()},K=function(){var e=X(myCards.getAllCards());C.firstElementChild.innerText=e},Y=function(){var e=X(opCards.getAllCards());h.firstElementChild.innerText=e},O=function(e){var t=document.createElement("img");t.setAttribute("class","ws-card"),t.setAttribute("src","/images/"+e+".jpg"),C.appendChild(t),C.style.marginLeft=-C.offsetWidth/2+"px",K()},V=function(e){var t=document.createElement("img");t.setAttribute("class","ws-card"),t.setAttribute("src","/images/"+e+".jpg"),h.appendChild(t),h.style.marginLeft=-h.offsetWidth/2+"px",Y()},z=function(e){var t=document.createElement("img");t.setAttribute("class","ws-card"),t.setAttribute("src","/images/"+e+".jpg"),h.replaceChild(t,h.children[1]),Y()},F=function(){for(var e=1,t=h.children.length;t>e;e++)h.removeChild(h.children[1]);for(var e=1,t=C.children.length;t>e;e++)C.removeChild(h.children[1])},J=function(){var e=X(myCards.getAllCards()),t=X(opCards.getAllCards());M("blanker"===User.getUserType?e>t?Const.MESSAGE.BLANKER_WIN:t>e?Const.MESSAGE.PLAYER_WIN:Const.MESSAGE.PUSH:e>t?Const.MESSAGE.PLAYER_WIN:t>e?Const.MESSAGE.BLANKER_WIN:Const.MESSAGE.PUSH)},Q=function(e){var t=X(e),n=!1;return t>21&&(n=!0),n},X=function(e){for(var t,n,s=0;s<e.length;s++){var r=parseInt(e[s].substr(e[s].length-2),"10");r>10?r=10:1==r&&n++,t+=r}for(var s=0;n>s&&21>=t+10;s++)t+=10;return t},Z=function(e){n.innerText="在线人数： "+e},$=function(e){e.map(function(e){ee(e)})},ee=function(e){var t=document.createElement("li"),n=function(){return null===e.playerId?"人数未满":"人数已满"}();t.innerHTML='<a href="'+e.id+'" title="'+e.blankerId+'"><div> <span class="ws-imgbox"><img src="/images/ceil.jpg" alt=""></span></div><div class="ws-mes"><div class="ws-mes-title"><h3 class="ws-ellipsis">'+e.name+'</h3><span class="ws-flag"> '+n+'</span></div><p><span class="ws-blanker-nick ws-ellipsis">'+e.blankerNickname+"</span></p></div></a>",r.children[0].appendChild(t)},te=function(e){for(var t=r.children[0].children,n=0,i=t.length;i>n;n++)t[n].children[0].getAttribute("href")===e.ceilId&&(t[n].children[0].setAttribute("href",e.ceilId),t[n].children[0].setAttribute("title",e.blankerId),null!=e.playerId&&(s[n].innerText="人数已满"))},ne=function(e){for(var t=r.children[0].children,n=0,s=t.length;s>n;n++)t[n].children[0].getAttribute("href")===e&&r.children[0].removeChild(t[n])};return w(),{loginBoxOut:B,showCeilList:$,showCeil:k,showIndex:U,showUpCard:V,beginAction:W,showMessage:M,replaceCardBack:z,activeStandAndHit:H,compareCards:J,indexUpdateUserNum:Z,indexAddCeil:ee,indexUpdateCeil:te,indexDelCeil:ne}}(new Request);