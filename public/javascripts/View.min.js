var View=function(e){var t=3e3,n=document.getElementById("online_number"),s=document.getElementsByClassName("ws-flag"),r=document.getElementById("ceillist"),i=document.getElementById("login"),a=document.getElementById("loginBtn"),d=document.getElementById("nickname"),l=document.getElementById("addCeil"),c=document.getElementById("addCeilBtn"),o=document.getElementById("ceilname"),u=document.getElementById("addCeilSureBtn"),m=document.getElementById("stand"),g=document.getElementById("hit"),f=document.getElementById("begin"),h=document.getElementById("exit"),A=document.getElementById("up-cards"),p=document.getElementById("down-cards"),C=document.getElementById("index"),E=document.getElementById("ceil"),w=document.getElementById("message"),b={addHandler:function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},removeHandler:function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null}},v=function(){b.addHandler(a,"click",function(e){_(e)}),b.addHandler(c,"click",I),b.addHandler(u,"click",function(e){P(e)}),b.addHandler(r,"click",function(e){W(e)})},y=function(){myCards.setNull(),opCards.setNull(),Cards.getNewCards(),J(),x(),R(),b.addHandler(h,"click",e.exitRequest),b.addHandler(f,"click",j),"blanker"===User.getUserType()&&T()},B=function(){i.setAttribute("class","ws-hide")},I=function(){l.setAttribute("class","ws-login")},k=function(){l.setAttribute("class","ws-hide")},S=function(){C.setAttribute("class","ws-hide"),k(),E.setAttribute("class","ws-ceil"),y()},U=function(){E.setAttribute("class","ws-hide"),C.removeAttribute("class")},x=function(){A.style.marginLeft="0px",A.children[0].innerText="0",A.setAttribute("class","ws-cards ws-blanker ws-border"),p.style.marginLeft="0px",p.children[0].innerText="0",p.setAttribute("class","ws-cards ws-player ws-border")},T=function(){f.setAttribute("class","ws-hide"),b.removeHandler(f,"click",j)},N=function(){f.setAttribute("class","ws-hide"),h.setAttribute("class","ws-hide")},L=function(){h.setAttribute("class","ws-hide")},R=function(){f.setAttribute("class","ws-option ws-begin"),h.setAttribute("class","ws-option ws-exit")},H=function(){b.addHandler(m,"click",K),b.addHandler(g,"click",D),m.setAttribute("class","ws-action ws-stand"),g.setAttribute("class","ws-action ws-hit")},M=function(){b.removeHandler(m,"click",K),b.removeHandler(g,"click",D),m.setAttribute("class","ws-action ws-stand ws-locked"),g.setAttribute("class","ws-action ws-hit ws-locked")},q=function(e,n){w.innerText=e,w.setAttribute("class","ws-message"),setTimeout(function(){G(n)},t)},G=function(e){w.setAttribute("class","ws-hide"),console.log("next: "+e),e?U():y()},_=function(t){t.preventDefault();var n=d.value;""==n?alert("昵称不能为空"):e.loginRequest(n)},P=function(t){t.preventDefault();var n=o.value;""==n?alert("房间昵称不能为空"):e.addCeilRequest(n)},W=function(t){t.preventDefault();var n=t.target||t.srcElement,s=n.parentNode.parentNode.parentNode,r=s.getAttribute("href"),i=s.getAttribute("title");e.enterRequest(r,i)},j=function(){"player"===User.getUserType()?(N(),H()):L(),myCards.addCard(Cards.getNewCard()),myCards.addCard(Cards.getNewCard());var t=myCards.getAllCards();A.setAttribute("class","ws-cards ws-blanker"),p.setAttribute("class","ws-cards ws-player"),t.map(function(e){V(e)}),e.beginRequest(t),X(t)&&(e.bustRequest(),"player"===User.getUserType()?q(Const.MESSAGE.PLAYER_BUST):"blanker"===User.getUserType()&&q(Const.MESSAGE.BLANKER_BUST))},D=function(){var t=Cards.getNewCard();myCards.addCard(t),V(t),e.hitRequest(t),X(myCards.getAllCards())&&(e.bustRequest(),"player"===User.getUserType()?q(Const.MESSAGE.PLAYER_BUST):"blanker"===User.getUserType()&&q(Const.MESSAGE.BLANKER_BUST))},K=function(){M(),e.standRequest(myCards.getAllCards()[0]),"blanker"===User.getUserType()&&Q()},Y=function(){var e=Z(myCards.getAllCards());p.firstElementChild.innerText=e},O=function(){var e=Z(opCards.getAllCards());A.firstElementChild.innerText=e},V=function(e){var t=document.createElement("img");t.setAttribute("class","ws-card"),t.setAttribute("src","/images/"+e+".jpg"),p.appendChild(t),p.style.marginLeft=-p.offsetWidth/2+"px",Y()},z=function(e){var t=document.createElement("img");t.setAttribute("class","ws-card"),t.setAttribute("src","/images/"+e+".jpg"),A.appendChild(t),A.style.marginLeft=-A.offsetWidth/2+"px",O()},F=function(e){var t=document.createElement("img");t.setAttribute("class","ws-card"),t.setAttribute("src","/images/"+e+".jpg"),A.replaceChild(t,A.children[1]),O()},J=function(){for(var e=1,t=A.children.length;t>e;e++)A.removeChild(A.children[1]);for(var e=1,t=p.children.length;t>e;e++)p.removeChild(p.children[1])},Q=function(){var e=Z(myCards.getAllCards()),t=Z(opCards.getAllCards());"blanker"===User.getUserType()?q(e>t?Const.MESSAGE.BLANKER_WIN:t>e?Const.MESSAGE.PLAYER_WIN:Const.MESSAGE.PUSH):"player"===User.getUserType()&&q(e>t?Const.MESSAGE.PLAYER_WIN:t>e?Const.MESSAGE.BLANKER_WIN:Const.MESSAGE.PUSH)},X=function(e){var t=Z(e),n=!1;return t>21&&(n=!0),n},Z=function(e){for(var t=0,n=0,s=0;s<e.length;s++){var r=parseInt(e[s].substr(e[s].length-2),"10");r>10?r=10:1==r&&n++,t+=r}for(var s=0;n>s&&21>=t+10;s++)t+=10;return t},$=function(e){n.innerText="在线人数： "+e},ee=function(e){e.map(function(e){te(e)})},te=function(e){var t=document.createElement("li"),n=function(){return null===e.playerId?"人数未满":"人数已满"}();t.innerHTML='<a href="'+e.id+'" title="'+e.blankerId+'"><div> <span class="ws-imgbox"><img src="/images/ceil.jpg" alt=""></span></div><div class="ws-mes"><div class="ws-mes-title"><h3 class="ws-ellipsis">'+e.name+'</h3><span class="ws-flag"> '+n+'</span></div><p><span class="ws-blanker-nick ws-ellipsis">'+e.blankerNickname+"</span></p></div></a>",r.children[0].appendChild(t)},ne=function(e){for(var t=r.children[0].children,n=0,i=t.length;i>n;n++)t[n].children[0].getAttribute("href")===e.ceilId&&(t[n].children[0].setAttribute("href",e.ceilId),t[n].children[0].setAttribute("title",e.blankerId),null!=e.playerId&&(s[n].innerText="人数已满"))},se=function(e){for(var t=r.children[0].children,n=0,s=t.length;s>n;n++)t[n].children[0].getAttribute("href")===e&&r.children[0].removeChild(t[n])};return v(),{loginBoxOut:B,showCeilList:ee,showCeil:S,showIndex:U,showUpCard:z,beginAction:j,showMessage:q,replaceCardBack:F,activeStandAndHit:H,compareCards:Q,indexUpdateUserNum:$,indexAddCeil:te,indexUpdateCeil:ne,indexDelCeil:se}}(new Request);